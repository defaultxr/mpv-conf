#  MPV - mpv.conf
#  deus0ww - 2019-02-27



############
# Playback #
############
#force-seekable=yes
#merge-files=yes
reset-on-next-file=all
save-position-on-quit=no
use-filedir-conf=no
write-filename-in-watch-later-config=no

user-agent="Mozilla/5.0 (Macintosh; Intel Mac OS X 10_13_6) AppleWebKit/605.1.15 (KHTML, like Gecko) Version/12.0 Safari/605.1.15"
ytdl-format="(best[ext=mp4]/best)[protocol!=http_dash_segments]/bestvideo[ext=mp4]+bestaudio[ext=m4a]/best[ext=mp4]/bestvideo+bestaudio/best"



################
# Logs & Paths #
################
log-file="~/Library/Logs/mpv-running.log"
msg-level=all=error

icc-cache-dir="/Users/Shared/Library/Caches/mpv/icc/"
gpu-shader-cache-dir="/Users/Shared/Library/Caches/mpv/shader/"



##############
# Screenshot #
##############
screenshot-format=png
screenshot-tag-colorspace=yes
screenshot-png-compression=8
screenshot-directory="~/Desktop"
screenshot-template="~/Desktop/%F (%P) %n"



######
# UI #
######
autofit-larger=98%x98%
autofit-smaller=50%x50%
geometry=-0-0

cursor-autohide-fs-only=yes
cursor-autohide=480
#force-rgba-osd-rendering=yes
force-window=no
input-doubleclick-time=200
input-right-alt-gr=no
keep-open-pause=no
keep-open=yes
macos-title-bar-material=dark #fullscreen (10.14+)
native-fs=no

image-display-duration=inf



#######
# OSD #
#######
osc=no
load-stats-overlay=no
osd-level=1
osd-on-seek=msg-bar

osd-align-y=bottom
osd-bar-align-y=1
osd-margin-x=10
osd-margin-y=14

osd-bar-h=1
osd-bar-w=100
osd-duration=2000

#osd-font="SF Mono"
osd-font="Helvetica Neue"
osd-font-size=20
osd-color="#E0E0E0E0"
osd-bold=yes
osd-border-color="#E0000000"
osd-border-size=1.6
osd-blur=0.2
osd-spacing=0.2



#############
# Languages # - Disabled: Handled by Language_Switcher script
#############
#alang=ja,jap,jpn,japanese,th,tha,thai,en,eng,english
#slang=th,tha,thai,en,eng,english
ytdl-raw-options=sub-lang="th,tha,thTH,th-TH,en,eng,enUS,en-US",write-sub=,write-auto-sub=



###################
# Cache & Demuxer #
###################
cache=auto
cache-file="TMP"
cache-pause-wait=4
cache-pause-initial=yes
demuxer-seekable-cache=auto
demuxer-mkv-subtitle-preroll=index
demuxer-mkv-subtitle-preroll-secs=4        # Seconds
demuxer-mkv-subtitle-preroll-secs-index=4  # Seconds
hr-seek-framedrop=no
network-timeout=0

[ww-cache-low]
cache-default=32768                        # KiB
cache-backbuffer=16384                     # KiB
cache-initial=512                          # KiB
cache-seek-min=8192                        # KiB
demuxer-max-bytes=65536KiB                 # KiB, MiB
demuxer-max-back-bytes=32768KiB            # KiB, MiB

[ww-cache-high]
cache-default=262144                       # KiB
cache-backbuffer=131072                    # KiB
cache-initial=4096                         # KiB
cache-seek-min=65536                       # KiB
demuxer-max-bytes=524288KiB                # KiB, MiB
demuxer-max-back-bytes=262144KiB           # KiB, MiB



#############
# Protocols #
#############
[protocol.http]
profile=ww-cache-high
network-timeout=5
force-window=immediate

[protocol.https]
profile=ww-cache-high
network-timeout=5
force-window=immediate

[protocol.file]
profile=ww-cache-low
network-timeout=0
force-window=no



#############
# Subtitles #
#############
[ww-subtitle]
profile-desc="WW - Subtitle Settings"
sub-auto=fuzzy
sub-file-paths-append=ass
sub-file-paths-append=srt
sub-file-paths-append=sub
sub-file-paths-append=subs
sub-file-paths-append=subtitles
sub-fix-timing=no

sub-ass-force-margins=yes
sub-ass-force-style=Kerning=yes
sub-ass-hinting=native
sub-ass-line-spacing=16
sub-ass-override=scale
sub-ass-vsfilter-aspect-compat=no
sub-ass-vsfilter-blur-compat=no
sub-ass-vsfilter-color-compat=no

sub-font="SukhumvitSet-Medium"
sub-font-size=40
sub-scale=0.75
sub-color="#E0E0E0E0"
sub-border-color="#E0000000"
sub-gray=yes
sub-border-size=2.4
sub-blur=0.3
sub-spacing=0.3
sub-justify=left
sub-margin-y=14



##################
# Audio Profiles #
##################
[ww-audio-clear]
af-clr

[ww-audio-common]
profile-desc="WW - Audio - Common Settings"
profile=ww-audio-clear
audio-file-auto=fuzzy
ad-lavc-threads=16
volume=50
volume-max=150

[ww-audio-upsample]
profile-desc="WW - Audio - Upsampling"
audio-resample-filter-size=32  #SWR only
audio-resample-phase-shift=10  #SWR only
audio-resample-cutoff=0.96
audio-resample-linear=yes
audio-normalize-downmix=yes

[ww-audio-upsample-soxr]
profile-desc="WW - Audio - SOXR Upsampling"
profile=ww-audio-upsample
audio-swresample-o="dither_method=low_shibata:resampler=soxr:cutoff=0.96:precision=33:cheby=1"

[ww-audio-low]
profile=ww-audio-common,ww-audio-upsample
audio-samplerate=96000

[ww-audio-mid]
profile=ww-audio-common,ww-audio-upsample-soxr
audio-samplerate=96000

[ww-audio-high]
profile=ww-audio-common,ww-audio-upsample-soxr
audio-samplerate=192000



##################
# Video Profiles #
##################

#Profile gpu-hq: 
# scale=spline36
# cscale=spline36
# dscale=mitchell
# dither-depth=auto
# correct-downscaling=yes
# linear-downscaling=yes
# sigmoid-upscaling=yes
# deband=yes

[ww-video-clear]
vf-clr
glsl-shaders-clr

[ww-video-common]
profile-desc="WW - Video - Common Settings"
profile=ww-video-clear
vo=libmpv
cocoa-force-dedicated-gpu=yes
opengl-pbo=yes
swapchain-depth=8
video-sync=display-resample
icc-3dlut-size=256x256x256
icc-contrast=1000
icc-profile-auto=yes
alpha=no
scaler-lut-size=10
sigmoid-center=0.8
sigmoid-slope=8.0
deband-iterations=4
deband-range=16
deband-threshold=72
deband-grain=0
temporal-dither=yes
tscale=box
tscale-window=sphinx
tscale-radius=1.01
tscale-clamp=0.0
interpolation=no
vd-lavc-dr=no
vd-lavc-threads=64
#input-ipc-server=/tmp/mpvsocket #For SVP


### Video LOW ###
[ww-video-low]
profile-desc="WW - Video - Low Quality"
profile=ww-video-common
script-opts-add=auto-profiles=no,thumbnailer-max_workers=1
hwdec=auto
fbo-format=rgba16
sws-scaler=bilinear
scale=bilinear
scale-antiring=0.0
cscale=bilinear
cscale-antiring=0.0
dscale=bilinear
dscale-antiring=0.0
dither-depth=no
correct-downscaling=no
linear-downscaling=no
linear-upscaling=no
sigmoid-upscaling=no
deband=no


### Video MID ###
[ww-video-mid]
profile-desc="WW - Video - Mid Quality"
profile=ww-video-common,gpu-hq
script-opts-add=auto-profiles=no,thumbnailer-max_workers=6
hwdec=no
fbo-format=rgba16f
sws-scaler=spline
scale=spline64
scale-antiring=1.0
cscale=spline64
cscale-antiring=1.0
dscale=spline64
dscale-antiring=1.0


### Video HIGH ###
[ww-video-high]
profile-desc="WW - Video - High Quality Base Settings"
profile=ww-video-common,gpu-hq
script-opts-add=auto-profiles=yes
hwdec=no
fbo-format=rgba32f
display-fps=60
sws-scaler=spline
scale=ewa_hanning
scale-antiring=0.0
scale-window=blackman
scale-radius=3.2383154841662362
cscale=ewa_hanning
cscale-antiring=0.0
cscale-window=blackman
cscale-radius=3.2383154841662362
dscale=ewa_hanning
dscale-antiring=0.0
dscale-window=blackman
dscale-radius=3.2383154841662362


[ww-video-high-shaders]
glsl-shaders-append="~~/shaders/EnhanceDetail.glsl"
glsl-shaders-append="~~/shaders/KrigBilateral.glsl"


[ww-video-high-sd]
profile-desc=cond:( get("estimated-vf-fps",math.huge)<=30 and math.min(3840/get("width",math.huge),2160/get("height",math.huge))>=4.0 )
profile=ww-video-high
glsl-shaders-append="~~/shaders/FSRCNNX_x4_16-0-4-1.glsl"
glsl-shaders-append="~~/shaders/FineSharp-x4.glsl"
profile=ww-video-high-shaders
script-opts-add=thumbnailer-max_workers=6

[ww-video-high-hd]
profile-desc=cond:( get("estimated-vf-fps",math.huge)<=30 and math.min(3840/get("width",math.huge),2160/get("height",math.huge))<4.0  and math.min(3840/get("width",math.huge),2160/get("height",math.huge))>2.4 )
profile=ww-video-high
glsl-shaders-append="~~/shaders/FSRCNNX_x3_16-0-4-1.glsl"
glsl-shaders-append="~~/shaders/FineSharp-x3.glsl"
profile=ww-video-high-shaders
script-opts-add=thumbnailer-max_workers=6

[ww-video-high-fhd]
profile-desc=cond:( get("estimated-vf-fps",math.huge)<=30 and math.min(3840/get("width",math.huge),2160/get("height",math.huge))<=2.4 and math.min(3840/get("width",math.huge),2160/get("height",math.huge))>=1.5 )
profile=ww-video-high
glsl-shaders-append="~~/shaders/FSRCNNX_x2_8-0-4-1.glsl"
glsl-shaders-append="~~/shaders/FineSharp-x2.glsl"
profile=ww-video-high-shaders
script-opts-add=thumbnailer-max_workers=6


[ww-video-high-sd-hifps]
profile-desc=cond:( get("estimated-vf-fps",math.huge)>30  and math.min(3840/get("width",math.huge),2160/get("height",math.huge))>=4.0 )
profile=ww-video-high
glsl-shaders-append="~~/shaders/FSRCNNX_x4_16-0-4-1.glsl"
profile=ww-video-high-shaders
script-opts-add=thumbnailer-max_workers=4

[ww-video-high-hd-hifps]
profile-desc=cond:( get("estimated-vf-fps",math.huge)>30  and math.min(3840/get("width",math.huge),2160/get("height",math.huge))<4.0  and math.min(3840/get("width",math.huge),2160/get("height",math.huge))>2.4 )
profile=ww-video-high
glsl-shaders-append="~~/shaders/FSRCNNX_x3_16-0-4-1.glsl"
profile=ww-video-high-shaders
script-opts-add=thumbnailer-max_workers=4

[ww-video-high-fhd-hifps]
profile-desc=cond:( get("estimated-vf-fps",math.huge)>30  and math.min(3840/get("width",math.huge),2160/get("height",math.huge))<=2.4 and math.min(3840/get("width",math.huge),2160/get("height",math.huge))>=1.5 )
profile=ww-video-high
glsl-shaders-append="~~/shaders/FSRCNNX_x2_8-0-4-1.glsl"
glsl-shaders-append="~~/shaders/EnhanceDetail.glsl"
script-opts-add=thumbnailer-max_workers=4


[ww-video-high-uhd]
profile-desc=cond:( math.min(3840/get("width",math.huge),2160/get("height",math.huge))<1.5 )
profile=ww-video-high
script-opts-add=thumbnailer-max_workers=1



###########
# Scripts #
###########
[ww-retina]
script-opts-add=osc-scalefullscreen=1.50,osc-scalewindowed=1.50

[ww-non-retina]
script-opts-add=osc-scalefullscreen=0.75,osc-scalewindowed=0.75



######################
# Effective Profiles #
######################
[default]
 profile=ww-cache-low,ww-subtitle
#profile=ww-audio-low,ww-video-low,ww-non-retina
#profile=ww-audio-low,ww-video-mid,ww-non-retina
 profile=ww-audio-mid,ww-video-mid,ww-non-retina
#profile=ww-audio-high,ww-video-high,ww-retina

